<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Şifre Sıfırla (Şirket) | Akrep App</title>
    <link rel="stylesheet" href="style.css" />
    <script
      src="https://kit.fontawesome.com/e8e1e0fe95.js"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header class="navbar">
      <div class="navbar-left">
        <img src="assets/akrep-logo.jpg" alt="Akrep App Logo" class="logo" />
        <span class="brand">Akrep App</span>
      </div>

      <nav class="navbar-center">
        <a href="index.html">Anasayfa</a>
        <a href="hakkimizda.html">Hakkımızda</a>
        <a href="nasilkullanilir.html">Nasıl Kullanılır</a>
        <a href="basindaakrep.html">Basında Akrep</a>
        <a href="bizeulasin.html">Bize Ulaşın</a>
      </nav>

      <div class="navbar-right">
        <a href="#"><i class="fab fa-linkedin-in"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
      </div>
    </header>
    <section class="hero">
      <div class="hero-left">
        <img
          src="assets/logo.png"
          alt="Akrep App Hero Logo"
          class="hero-logo animate-in"
        />
      </div>
      <div class="hero-right">
        <form id="resetCompaniesForm" class="contact-form" autocomplete="off" style="max-width: 350px;">
          <h2 style="color:white; margin-bottom:18px;">Şirket Şifresi Sıfırla</h2>
          <input
            type="password"
            id="newPassword"
            name="newPassword"
            placeholder="Yeni şifre"
            required
          />
          <input
            type="password"
            id="repeatPassword"
            name="repeatPassword"
            placeholder="Yeni şifre tekrarı"
            required
          />
          <button type="submit" class="submit-button">Şifreyi Sıfırla</button>
          <div id="resetCompaniesMessage" style="margin-top:14px; min-height:24px;"></div>
        </form>
      </div>
    </section>

    <img
      src="assets/phone.png"
      alt="Telefon Görseli"
      class="phone-image animate-slide-in"
    />

    <script>
      document.getElementById('resetCompaniesForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const newPassword = document.getElementById('newPassword').value;
        const repeatPassword = document.getElementById('repeatPassword').value;
        const messageDiv = document.getElementById('resetCompaniesMessage');
        messageDiv.textContent = '';
        messageDiv.style.color = 'white';

        if (newPassword !== repeatPassword) {
          messageDiv.textContent = 'Şifreler eşleşmiyor!';
          messageDiv.style.color = '#ffbaba';
          return;
        }

        // TODO: Token ve email bilgisini uygun şekilde doldurun
        const token = ""; // URL'den veya başka bir kaynaktan alınmalı
        const email = ""; // URL'den veya başka bir kaynaktan alınmalı

        if (!token || !email) {
          messageDiv.textContent = 'Token ve e-posta eksik!';
          messageDiv.style.color = '#ffbaba';
          return;
        }

        try {
          const response = await fetch('http://34.70.109.62:4001/companies/reset-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token, email, newPassword }),
          });
          const data = await response.json();
          if (response.ok) {
            messageDiv.textContent = 'Şirket şifresi başarıyla sıfırlandı!';
            messageDiv.style.color = '#7aef7a';
          } else {
            messageDiv.textContent = data.message || 'Bir hata oluştu. Lütfen bilgilerinizi kontrol edin.';
            messageDiv.style.color = '#ffbaba';
          }
        } catch (err) {
          messageDiv.textContent = 'Sunucuya ulaşılamıyor. Lütfen daha sonra tekrar deneyin.';
          messageDiv.style.color = '#ffbaba';
        }
      });
    </script>
  </body>
</html>
